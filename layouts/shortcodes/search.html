{{ $cdn := "https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.6.7" }}
{{ $js := $cdn | printf "/lunar.min.js" }}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{{ $js }}" integrity="sha512-/pbV2bQIFeZytnq5U363HlJRoyYrhYOQv1YMwaQs5ny7GcCRaaqwU7Hf1ni8nXx7V5Z5K+Xp1Yfv5LD19/zqrg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  var searchInput = document.createElement("input");
  searchInput.setAttribute("id", "search-input");
  searchInput.setAttribute("type", "search");
  searchInput.setAttribute("placeholder", "Search...");
  document.body.appendChild(searchInput);

  var searchButton = document.createElement("button");
  searchButton.setAttribute("id", "search-button");
  searchButton.setAttribute("type", "button");
  
  var buttonText = document.createTextNode("Search");
  searchButton.appendChild(buttonText);
  document.body.appendChild(searchButton);

  var resultsContainer = document.createElement("div");
  resultsContainer.setAttribute("id", "search-results");
  document.body.appendChild(resultsContainer);

  var searchForm = document.createElement("form");
  searchForm.style.display = "none";
  document.body.appendChild(searchForm);

  var searchUrl = "{{ "/search.json" | relURL }}";

  searchButton.addEventListener("click", function() {
    var keywords = searchInput.value.trim();
    if (keywords !== "") {
      searchForm.innerHTML = "";
      var hiddenInput = document.createElement("input");
      hiddenInput.setAttribute("type", "hidden");
      hiddenInput.setAttribute("name", "q");
      hiddenInput.setAttribute("value", keywords);
      searchForm.appendChild(hiddenInput);

      var xhr = new XMLHttpRequest();
      xhr.open("GET", searchUrl);
      xhr.onload = function() {
        var searchData = JSON.parse(xhr.responseText);
        Lunar.handleSearch(searchData, {
          inputElement: searchInput,
          resultsElement: resultsContainer,
          previewLength: 100,
          summaryLength: 300
        });
      };
      xhr.send(new FormData(searchForm));
    }
  });
});
</script>