{- $pages := slice -}}
{{- range where .Site.RegularPages "Params.draft" "!=" "true" -}}
    {{- $pages = $pages | append . -}}
{{- end -}}

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.1/dist/fuse.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<input type="text" id="searchInput" placeholder="Search..." />
<ul id="searchResults"></ul>

<script>
    // Perform the search
    function performSearch() {
        // Get the search query
        var query = $('#searchInput').val().toLowerCase();

        // Prepare Fuse.js options
        var options = {
            keys: ['Params.title', 'Content']
        };

        // Initialize Fuse.js with the pages data
        var fuse = new Fuse({{ $pages | jsonify }}, options);

        // Perform the search
        var results = fuse.search(query);

        // Display the search results
        var resultsList = $('#searchResults');
        resultsList.empty();

        for (var i = 0; i < results.length; i++) {
            var item = results[i].item;
            var listItem = '<li><a href="' + item.RelPermalink + '">' + item.Params.title + '</a></li>';
            resultsList.append(listItem);
        }
    }

    // Attach event listener to the search input
    $(document).ready(function() {
        $('#searchInput').on('input', performSearch);
    });
</script>